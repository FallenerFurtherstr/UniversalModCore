name: Universal Mod Core CI

on: [push]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: |
                ref=`echo ${github_ref} | sed -e 's,refs/heads/,,' | tr '/' '-'`
                echo $ref
                echo "::set-env name=ref::$ref"
              env:
                github_ref: ${{ github.ref }}
                ACTIONS_ALLOW_UNSECURE_COMMANDS: true
            - name: Gradle build
              run: ./gradlew build
            - name: XVFB
              run: sudo apt-get install -y xvfb xargs
            - name: Gen Data
              run: xvfb-run --auto-servernum ./gradlew genData
            - name: Cleanup
              run: ps aux | grep tmp/xvfb-run | grep -v grep | awk '{print $2}' | xargs -I foo sudo kill foo
            - uses: actions/upload-artifact@v2-preview
              with:
                name: UniversalModCore-${{ env.ref }}
                path: build/libs/UniversalModCore-*.jar


